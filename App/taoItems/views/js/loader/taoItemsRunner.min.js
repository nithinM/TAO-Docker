define("taoItems/assets/manager",["lodash","util/url"],function(_,urlUtil){"use strict";var checkStrategy=function(strategy){if(!_.isPlainObject(strategy)||!_.isFunction(strategy.handle)||!_.isString(strategy.name))throw new TypeError("An asset resolution strategy is an object with a handle method and a name")};return function(strategies,data,options){var cache={};strategies=_.isArray(strategies)?strategies:[strategies],data=data||{},options=_.defaults(options||{},{parseUrl:!0});var assetManager={_strategies:[],addStrategy:function(strategy){checkStrategy(strategy),this._strategies.push(strategy)},prependStrategy:function(strategy){checkStrategy(strategy),
this._strategies.unshift(strategy)},setStrategies:function(newStrategies){var self=this;this._strategies=[],_.forEach(newStrategies,function(strategy){_.isPlainObject(strategy)?assetManager.addStrategy(strategy):_.isFunction(strategy)&&self.addStrategy({name:"strategy_"+(self._strategies.length+1),handle:strategy})})},setData:function(key,value){_.isString(key)&&void 0!==value?data[key]=value:_.isPlainObject(key)&&(data=key)},getData:function(key){return _.isString(key)?data[key]:data},resolve:function(url){var resolved,inputUrl;return options.cache&&cache.hasOwnProperty(url)?cache[url]:(inputUrl=options.parseUrl?urlUtil.parse(url):url,_.forEach(
this._strategies,function(strategy){var result=strategy.handle(inputUrl,data);if(result)return resolved=result,!1}),resolved=resolved||"",options.cache&&(cache[url]=resolved),resolved)},resolveBy:function(name,url){var inputUrl,resolved="",strategy=_.find(this._strategies,{name:name});return strategy&&(inputUrl=options.parseUrl?urlUtil.parse(url):url,resolved=strategy.handle(inputUrl,data)),resolved},clearCache:function(){options.cache&&(cache={})}};return assetManager.setStrategies(strategies),assetManager}}),define("taoItems/assets/strategies",["util/url","lodash"],function(urlUtil,_){"use strict";var prependToUrl=function(url,base,slashcat){
return!0===slashcat?base.replace(/\/$/,"")+"/"+url.directory.replace(/^\.\//,"").replace(/^\//,"")+encodeURIComponent(url.file.replace(/^\.\//,"").replace(/^\//,"")):base+url.directory.replace(/^\.?\//,"")+encodeURIComponent(url.file.replace(/^\.?\//,""))};return{packedUrl:{name:"packedUrl",handle:function(url,data){var type;if(!_.isUndefined(url.source)&&!_.isUndefined(data.assets)&&(type=_.findKey(data.assets,url.source))&&urlUtil.isAbsolute(data.assets[type][url.source]))return data.assets[type][url.source]}},baseUrl:{name:"baseUrl",handle:function(url,data){if("string"==typeof data.baseUrl&&urlUtil.isRelative(url))return prependToUrl(url,data.baseUrl,
data.slashcat)}},itemCssNoCache:{name:"itemCssNoCache",handle:function(url,data){if("string"==typeof data.baseUrl&&urlUtil.isRelative(url)&&/\.css$/.test(url.file))return urlUtil.build(prependToUrl(url,data.baseUrl,data.slashcat),{bust:Date.now()})}},external:{name:"external",handle:function(url){if(urlUtil.isAbsolute(url))return url.toString()}},base64:{name:"base64",handle:function(url){if(urlUtil.isBase64(url))return url.toString()}},taomedia:{name:"taomedia",handle:function(url,data){var baseUrl=data.baseUrl||"./";if("object"==typeof url&&"taomedia"===url.protocol||/^taomedia:\/\//.test(url.toString()))return baseUrl+url.toString()}}}}),define(
"taoItems/runner/api/itemRunner",["jquery","lodash","core/eventifier","taoItems/assets/manager"],function($,_,eventifier,assetManagerFactory){"use strict";var itemRunnerFactory=function itemRunnerFactory(providerName,data,options){var provider,providers,assetManager,flow={init:{done:!1,pending:[]},render:{done:!1,pending:[]}};if(_.isPlainObject(providerName)&&(data=providerName,providerName=void 0),data=data||{},options=options||{},!(providers=itemRunnerFactory.providers)||0===_.size(providers))throw new Error("No provider regitered");if(_.isString(providerName)&&0<providerName.length?provider=providers[providerName]:1===_.size(providers)&&(
providerName=_.keys(providers)[0],provider=providers[providerName]),!provider)throw new Error("No candidate found for the provider");return assetManager=options.assetManager||assetManagerFactory(function(url){return url.toString()}),eventifier({container:null,assetManager:assetManager,options:options,init:function(newData){var self=this,initDone=function(){!1===flow.init.done&&(flow.init.done=!0,_.forEach(flow.init.pending,function(pendingTask){_.isFunction(pendingTask)&&pendingTask.call(self)}),flow.init.pending=[]),self.trigger("init")};return newData&&(data=_.merge(data,newData)),_.isFunction(provider.init)?provider.init.call(this,data,initDone):initDone(
),this},assets:function(strategies,data,options){try{this.assetManager=assetManagerFactory(strategies,data,options)}catch(err){this.trigger("error","Something was wrong while configuring the asset manager : "+err)}return this},render:function(elt,options){var self=this,renderDone=function(){!1===flow.render.done&&(flow.render.done=!0,_.forEach(flow.render.pending,function(pendingTask){_.isFunction(pendingTask)&&pendingTask.call(self)}),flow.render.pending=[]),self.trigger("render"),self.trigger("ready")};return options=_.defaults(options||{},{state:{}}),elt instanceof HTMLElement||elt instanceof $?(options.state&&this.setState(options.state),
!1===flow.init.done?flow.init.pending.push(function(){this.render(elt,options)}):(this.container=elt instanceof $?elt.get(0):elt,_.isFunction(provider.render)?provider.render.call(this,this.container,renderDone,options):renderDone()),this):self.trigger("error","A valid HTMLElement (or a jquery element) at least is required to render the item")},clear:function(){var self=this,clearDone=function(){self.trigger("clear")};return _.isFunction(provider.clear)?provider.clear.call(this,this.container,clearDone):clearDone(),this},getState:function(){var state=null;return _.isFunction(provider.getState)&&(state=provider.getState.call(this)),state},setState:function(
state){return _.isPlainObject(state)?(!1===flow.render.done?flow.render.pending.push(function(){this.setState(state)}):_.isFunction(provider.setState)&&provider.setState.call(this,state),this):this.trigger("error","The item's state must be a JavaScript Plain Object: "+typeof state+" given")},getResponses:function(){var responses={};return _.isFunction(provider.getResponses)&&(responses=provider.getResponses.call(this)),responses},renderFeedbacks:function(feedbacks,itemSession,done){_.isFunction(provider.renderFeedbacks)&&provider.renderFeedbacks.call(this,feedbacks,itemSession,done)}})};return itemRunnerFactory.register=function(name,provider){if(
!_.isString(name)||name.length<=0)throw new TypeError("It is required to give a name to your provider.");if(!_.isPlainObject(provider)||!_.isFunction(provider.init)&&!_.isFunction(provider.render))throw new TypeError("A provider is an object that contains at least an init function or a render function.");this.providers=this.providers||{},this.providers[name]=provider},itemRunnerFactory}),define("taoItems/loader/taoItemsRunner.bundle",function(){});
//# sourceMappingURL=taoItemsRunner.min.js.map