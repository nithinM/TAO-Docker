{
  "version": 3,
  "sources": [
    "../controller/admin/line!tpl",
    "../controller/admin/index.js",
    "../controller/routes.js",
    "../../../../../../../../../../../../module-create.js"
  ],
  "names": [],
  "mappings": "AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACvDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACnVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AChCA;AACA;AACA",
  "file": "taoDacSimple/loader/taoDacSimple.bundle.js",
  "sourcesContent": [
    "\ndefine('tpl!taoDacSimple/controller/admin/line', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, options, functionType=\"function\", escapeExpression=this.escapeExpression, helperMissing=helpers.helperMissing;\n\n\n  buffer += \"<tr>\\n    <td>\";\n  if (helper = helpers.label) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.label); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</td>\\n    <td>\\n        \";\n  if (helper = helpers.type) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.type); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\n        <input type=\\\"hidden\\\" name=\\\"users[\";\n  if (helper = helpers.user) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.user); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"][type]\\\" value=\\\"\";\n  if (helper = helpers.type) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.type); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\">\\n    </td>\\n    <td>\\n        <label>\\n            <input type=\\\"checkbox\\\" class=\\\"privilege-GRANT\\\" name=\\\"users[\";\n  if (helper = helpers.user) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.user); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"][GRANT]\\\" value=\\\"1\\\">\\n            <span class=\\\"icon-checkbox\\\"></span>\\n        </label>\\n    </td>\\n    <td>\\n        <label>\\n            <input type=\\\"checkbox\\\" class=\\\"privilege-WRITE\\\" name=\\\"users[\";\n  if (helper = helpers.user) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.user); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"][WRITE]\\\" value=\\\"1\\\" checked>\\n            <span class=\\\"icon-checkbox\\\"></span>\\n        </label>\\n    </td>\\n    <td>\\n        <label>\\n            <input type=\\\"checkbox\\\" class=\\\"privilege-READ\\\" name=\\\"users[\";\n  if (helper = helpers.user) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.user); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"][READ]\\\" value=\\\"1\\\" checked>\\n            <span class=\\\"icon-checkbox\\\"></span>\\n        </label>\\n    </td>\\n    <td>\\n        <button type=\\\"button\\\" class=\\\"small delete_permission btn-warning\\\" data-acl-user=\\\"\";\n  if (helper = helpers.user) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.user); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" data-acl-type=\\\"\";\n  if (helper = helpers.type) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.type); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" data-acl-label=\\\"\";\n  if (helper = helpers.label) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.label); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" >\\n            <span class=\\\"icon-bin\\\"></span>\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Remove\", options) : helperMissing.call(depth0, \"__\", \"Remove\", options)))\n    + \"\\n        </button>\\n    </td>\\n</tr>\";\n  return buffer;\n  });\n});\n\n",
    "/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2015-2019 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n */\ndefine('taoDacSimple/controller/admin/index',[\n    'jquery',\n    'lodash',\n    'i18n',\n    'tpl!taoDacSimple/controller/admin/line',\n    'helpers',\n    'ui/feedback',\n    'ui/autocomplete',\n    'util/httpErrorParser',\n    'ui/tooltip',\n    'jqueryui'\n], function ($, _, __, lineTpl, helpers, feedback, autocomplete, httpErrorParser, tooltip) {\n    'use strict';\n\n    /**\n     * The amount of displayed lines that fires the tabs mode\n     * @type {Number}\n     */\n    var linesThreshold = 10;\n\n    /**\n     * The warning message shown when all managers have been removed\n     * @type {String}\n     */\n    var errorMsgManagePermission = __('You must have one role or user that have the manage permission on this element.');\n\n    /**\n     * tooltip instance that serves all methods with same tooltip data and its state\n     * @type {Tooltip}\n     */\n    var errorTooltip;\n    /**\n     * Checks the managers, we need at least one activated manager.\n     * @param {jQuery|Element|String} container\n     * @returns {Boolean} Returns `true` if there is at least one manager in the list\n     * @private\n     */\n    var _checkManagers = function (container) {\n        var $managers = $(container).find('.privilege-GRANT:checked');\n        var checkOk = true;\n\n        if (!$managers.length) {\n            checkOk = false;\n        }\n        return checkOk;\n    };\n\n    /**\n     * Avoids to remove all managers\n     * @param {jQuery|Element|String} container\n     * @private\n     */\n    var _preventManagerRemoval = function(container){\n        var $form = $(container).closest('form');\n        var $submitter = $(':submit', $form);\n\n        if (!_checkManagers($form)) {\n            $submitter.addClass('disabled');\n            errorTooltip = tooltip.warning($submitter, errorMsgManagePermission, {\n                placement : 'bottom',\n                trigger: \"hover\",\n            });\n            feedback().warning(errorMsgManagePermission);\n        } else {\n            $submitter.removeClass('disabled');\n            if(errorTooltip){\n                errorTooltip.dispose();\n            }\n        }\n    };\n\n    /**\n     * Allow to enable / disable the access checkbox based on the state of the grant privilege\n     * @param {jQuery|Element|String} container\n     * @private\n     */\n    var _disableAccessOnGrant = function (container) {\n        var $container = $(container);\n\n        var $managersChecked = $container.find('.privilege-GRANT:checked').closest('tr');\n        var $cantChangeWrite = $managersChecked.find('.privilege-WRITE');\n        var $cantChangeRead = $managersChecked.find('.privilege-READ');\n\n        var $managers = $container.find('.privilege-GRANT').not(':checked').closest('tr');\n        var $canChangeWrite = $managers.find('.privilege-WRITE');\n        var $canChangeRead = $managers.find('.privilege-READ');\n\n        $canChangeWrite.removeClass('disabled');\n        $canChangeRead.removeClass('disabled');\n\n        $cantChangeWrite.addClass('disabled').prop('checked', true);\n        $cantChangeRead.addClass('disabled').prop('checked', true);\n\n        _preventManagerRemoval($container);\n        _disableAccessOnWrite($container);\n    };\n\n    /**\n     * Allow to enable / disable the access checkbox based on the state of the write privilege\n     * @param {jQuery|Element|String} container\n     * @private\n     */\n    var _disableAccessOnWrite = function (container) {\n        var $container = $(container);\n\n        var $writersChecked = $container.find('.privilege-WRITE:checked').closest('tr');\n        var $cantChangeRead = $writersChecked.find('.privilege-READ');\n\n        var $writers = $container.find('.privilege-WRITE').not(':checked').closest('tr');\n        var $canChangeRead = $writers.find('.privilege-READ');\n\n        $canChangeRead.removeClass('disabled');\n\n        $cantChangeRead.addClass('disabled').prop('checked', true);\n    };\n\n    /**\n     * Delete a permission row for a user/role\n     * @param  {DOM Element} element DOM element that triggered the function\n     * @private\n     */\n    var _deletePermission = function (element) {\n        // 1. Get the user / role\n        var $this = $(element);\n        var $container = $this.closest('table');\n        var type = $this.data('acl-type');\n        var user = $this.data('acl-user');\n        var label = $this.data('acl-label');\n\n        // 2. Remove it from the list\n        if (!_.isEmpty(type) && !_.isEmpty(user) && !_.isEmpty(label)) {\n            $this.closest('tr').remove();\n        }\n\n        _preventManagerRemoval($container);\n        _manageTabsDisplay();\n    };\n\n    /**\n     * Checks if a permission has already been added to the list.\n     * Highlight the list if the permission is already in the list.\n     * @param {jQuery|Element|String} container\n     * @param {String} type role/user regarding what it will be added.\n     * @param {String} id The identifier of the resource.\n     * @returns {boolean} Returns true if the permission is already in the list\n     * @private\n     */\n    var _checkPermission = function (container, type, id) {\n        var $btn = $(container).find('button[data-acl-user=\"' + id + '\"]'),\n            $line = $btn.closest('tr');\n\n        if ($line.length) {\n            $line.effect('highlight', {}, 1500);\n            return true;\n        }\n\n        return false;\n    };\n\n    /**\n     * Add a new lines into the permissions table regarding what is selected into the add-* select\n     * @param {jQuery|Element|String} container\n     * @param {String} type role/user regarding what it will be added.\n     * @param {String} id The identifier of the resource.\n     * @param {String} label The label of the resource.\n     * @private\n     */\n    var _addPermission = function (container, type, id, label) {\n        var $container = $(container),\n            $body = $container.find('tbody').first();\n\n        // only add the permission if it's not already present in the list\n        if (!_checkPermission($container, type, id)) {\n            $body.append(lineTpl({\n                type: type,\n                user: id,\n                label: label\n            }));\n            _disableAccessOnGrant($container);\n            _manageTabsDisplay();\n        }\n    };\n\n    /**\n     * Ensures that if you give the manage (GRANT) permission, access (WRITE and READ) permissions are given too\n     * Listens all clicks on delete buttons to call the _deletePermission function\n     * @param {jQuery|Element|String} container The container on which apply the listeners\n     * @private\n     */\n    var _installListeners = function(container) {\n        var $container = $(container);\n        $container.on('click', '.privilege-GRANT:not(.disabled) ', function () {\n            _disableAccessOnGrant($container);\n        }).on('click', '.privilege-WRITE:not(.disabled) ', function () {\n            _disableAccessOnWrite($container);\n        }).on('click', '.delete_permission:not(.disabled)', function (event) {\n            event.preventDefault();\n            _deletePermission(this);\n        });\n    };\n\n    /**\n     * Manages the display of tabs.\n     * If the total amount of lines per tables is too big, display the tabs. Otherwise, hide them.\n     * @private\n     */\n    var _manageTabsDisplay = function() {\n        var $tabs = $('.permission-tabs');\n        var needsTabs = $tabs.find('.privilege-GRANT').length > linesThreshold;\n        var $focused, index;\n\n        if (needsTabs) {\n            $tabs.find('ul').show();\n            if (!$tabs.hasClass('ui-tabs')) {\n                // get the current focused panel\n                $focused = $tabs.find(':focus').closest('.permission-tabs-panel');\n                index = Math.max(0, $focused.index() - 1);\n\n                // install the tabs, but keep the current panel focused\n                $tabs.tabs({\n                    // use two options to be compatible with both older and current version of jQueryUI\n                    selected: index,\n                    active: index\n                });\n            }\n            $('.msg-edit-area label span').hide();\n        } else {\n            if ($tabs.hasClass('ui-tabs')) {\n                $tabs.find('.ui-tabs-hide').removeClass('ui-tabs-hide');\n                $tabs.tabs('destroy');\n            }\n            $tabs.find('ul').hide();\n            $('.msg-edit-area label span').show();\n        }\n    };\n\n    /**\n     * Installs a search purpose autocompleter onto an element.\n     * @param {jQuery|Element|String} element The element on which install the autocompleter\n     * @param {Function} onSelectItem - The selection callback\n     * @returns {Autocompleter} Returns the instance of the autocompleter component\n     */\n    var _searchFactory = function (element, onSelectItem) {\n        var autocompleteOptions = {\n            isProvider: true,\n            preventSubmit: true\n        };\n        if (_.isFunction(onSelectItem)) {\n            autocompleteOptions.onSelectItem = onSelectItem;\n        }\n        return autocomplete(element, autocompleteOptions);\n    };\n\n    var mainCtrl = {\n        start: function start () {\n\n            var $container = $('.permission-container');\n            var $form = $('form', $container);\n            var $submitter = $(':submit', $form);\n\n            _disableAccessOnGrant('#permissions-table-users');\n            _disableAccessOnGrant('#permissions-table-roles');\n\n            // install autocomplete for user add\n            _searchFactory('#add-user', function (event, value, label) {\n                $('#add-user').focus();\n                _addPermission('#permissions-table-users', 'user', value, label);\n            });\n\n            // install autocomplete for role add\n            _searchFactory('#add-role', function (event, value, label) {\n                $('#add-role').focus();\n                _addPermission('#permissions-table-roles', 'role', value, label);\n            });\n\n            // ensure that if you give the manage (GRANT) permission, access (WRITE and READ) permissions are given too\n            _installListeners('#permissions-table-users');\n            _installListeners('#permissions-table-roles');\n\n            _manageTabsDisplay();\n\n            $form.on('submit', function (e) {\n                e.preventDefault();\n                e.stopImmediatePropagation();\n            });\n            $submitter.on('click', function (e) {\n                e.preventDefault();\n\n                if ($submitter.hasClass('disabled')) {\n                    return;\n                }\n\n                if (!_checkManagers('form')) {\n                    feedback().error(errorMsgManagePermission);\n                    return;\n                }\n\n                $submitter.addClass('disabled');\n\n                $.ajax({\n                    url : $form.attr('action'),\n                    type : 'POST',\n                    data : $form.serialize(),\n                    global : false\n                }).done(function (data) {\n                    feedback().success(__('Permissions saved'));\n                    if(data && data.tokenName && data.token) {\n                        $('[name=\"' + data.tokenName + '\"]', $form).val(data.token);\n                    }\n                }).fail(function(jqXHR, textStatus, errorThrown) {\n                    var error = httpErrorParser.parse(jqXHR, textStatus, errorThrown);\n                    feedback().error(error.message);\n                }).complete(function () {\n                    $submitter.removeClass('disabled');\n                });\n            });\n        }\n    };\n\n    return mainCtrl;\n});\n\n",
    "/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2014 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n *\n *\n */\n\ndefine('taoDacSimple/controller/routes',[],function(){\n    'user strict';\n    return {\n        'AdminAccessController' : {\n            'css': 'admin', \n            'actions' : {\n                'adminPermissions' : 'controller/admin/index'\n            }\n        }\n    };\n});\n\n",
    "\ndefine(\"taoDacSimple/loader/taoDacSimple.bundle\", function(){});\n"
  ]
}